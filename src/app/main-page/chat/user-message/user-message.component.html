<div
  (click)="onContainerClick($event, messageId)"
  (mouseleave)="closeEditMessagePopup()"
  class="main-chat-message-container transition-svg-text message py-[10px] flex items-center relative justify-end gap-[10px]"
  [ngClass]="{
    'flex-row-reverse': isContact,
    'px-[16px]': isReply || !isReply,
    'lg:px-[30px]': isReply,
    'lg:px-[45px]': !isReply
  }"
>
  <!-- reaction bar -->

  <div
    *ngIf="currentEditMessageId !== messageId"
    class="reaction-bar flex items-center gap-[10px] border-lines border-[1px] rounded-[30px] translate-y-[-50%] rounded-br-[0px] absolute top-0 bg-white pl-[20px] pr-[15px] py-[5px] transition-svg-text"
    [ngClass]="{
      'right-[50px]': isContact,
      'left-[20px] md:left-[50px]': !isContact,
      'right-[30px]': isContact && isReply,
      'left-[30px]': !isContact && isReply
    }"
  >
    <div
      *ngIf="!isReply"
      (click)="
        $event.stopPropagation();
        reactOnEmoji(
          'âœ…',
          loggedInUser.id,
          messageId,
          isDirectChat ? currentDirectChat.id || '' : currentChannel.id,
          likes
        )
      "
      class="transition-svg-text reaction-item-like"
    >
      <svg
        width="20"
        height="20"
        viewBox="0 0 20 20"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M10 20C15.5228 20 20 15.5228 20 10C20 4.47715 15.5228 0 10 0C4.47715 0 0 4.47715 0 10C0 15.5228 4.47715 20 10 20Z"
          fill="#4BD37B"
        />
        <path
          d="M14.6667 4L7.66667 11.2L5.33333 8.8L3 11.2L7.66667 16L17 6.4L14.6667 4Z"
          fill="white"
        />
      </svg>
    </div>

    <div
      *ngIf="!isReply"
      (click)="
        $event.stopPropagation();
        reactOnEmoji(
          'ðŸ™Œ',
          loggedInUser.id,
          messageId,
          isDirectChat ? currentDirectChat.id || '' : currentChannel.id,
          likes
        )
      "
      class="transition-svg-text reaction-item-like"
    >
      <svg
        width="20"
        height="20"
        viewBox="0 0 20 20"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M8.33765 0L10.0043 3.33333L11.671 0H8.33765ZM14.3043 0.333333L14.071 4.06667L17.171 2L14.3043 0.333333ZM2.83765 2L5.97098 4.06667L5.73765 0.333333L2.83765 2Z"
          fill="#4AA9FF"
        />
        <path
          d="M6.13768 20H2.20435V15.7L6.80435 16.7666C5.70435 17.9333 6.13768 20 6.13768 20Z"
          fill="#EBA352"
        />
        <path
          d="M5.77101 20H1.37101C1.37101 20 1.43768 17.8667 0.704346 16.0333L6.20435 16.8333C5.57101 18.4667 5.77101 20 5.77101 20ZM5.33768 14.1333H7.00435V6.73333C7.00435 6.23333 6.63768 5.83333 6.17101 5.83333C5.70435 5.83333 5.33768 6.23333 5.33768 6.76667V14.1333ZM3.37101 14.1333H5.33768V6.1C5.33768 5.5 4.90435 5 4.33768 5C3.80435 5 3.33768 5.5 3.33768 6.1V14.1333H3.37101Z"
          fill="#FFDD67"
        />
        <path
          d="M1.67116 14.1334H3.40449V6.56676C3.40449 6.03343 3.00449 5.6001 2.53783 5.6001C2.07116 5.6001 1.67116 6.03343 1.67116 6.56676V14.1334ZM0.871159 6.73343C0.437826 6.73343 0.104492 7.13343 0.104492 7.63343V14.1334H1.67116V7.63343C1.67116 7.13343 1.30449 6.73343 0.871159 6.73343Z"
          fill="#FFDD67"
        />
        <path
          d="M6.17113 5.8H6.00446C6.40446 5.86667 6.70446 6.26667 6.70446 6.7V14.1333H7.00446V6.73333C7.00446 6.23333 6.63779 5.8 6.17113 5.8ZM4.37113 5C4.30446 5 4.27113 5 4.23779 5.03333C4.70446 5.1 5.07113 5.56667 5.07113 6.1V11.4667L5.37113 11.8V6.1C5.33779 5.5 4.90446 5 4.37113 5ZM2.53779 5.6H2.40446C2.80446 5.66667 3.10446 6.06667 3.10446 6.53333V11.4333L3.40446 11.7667V6.56667C3.37113 6.03333 3.00446 5.6 2.53779 5.6ZM0.871126 6.73333C0.80446 6.73333 0.771126 6.73333 0.737793 6.76667C1.10446 6.83333 1.37113 7.2 1.37113 7.63333V11.4667L1.67113 11.8V7.63333C1.67113 7.13333 1.30446 6.73333 0.871126 6.73333Z"
          fill="#EBA352"
        />
        <path
          d="M9.80434 10.7333C9.30433 10.1666 8.30433 10.4333 7.60433 11.8999C7.10433 12.8999 6.971 12.6999 6.70434 12.7666V11.8666C6.70434 11.8666 0.0710007 11.4333 0.0710007 12.4333C0.0710007 12.4333 -0.228999 14.8999 0.404334 16.4333C1.371 18.7333 6.30434 19.3333 7.83767 15.4333C8.13767 14.6666 8.571 13.8333 8.90434 12.9999C9.33767 11.9999 10.371 11.3999 9.80434 10.7333Z"
          fill="#FFDD67"
        />
        <path
          d="M9.471 10.5C10.5377 11.3 8.571 12.8333 7.63766 15.2C6.30433 18.6 2.40433 18.6 0.770996 17.0333C2.271 18.8 6.43766 19.1333 7.83766 15.4333C8.771 13.0333 11.0377 11.2 9.471 10.5Z"
          fill="#EBA352"
        />
        <path
          d="M7.00415 12.7334C5.70415 12.2667 2.97082 13.1667 3.33749 15.7667C3.33749 13.3334 5.50415 12.7667 6.70415 12.7667C6.87082 12.7667 7.00415 12.7334 7.00415 12.7334ZM13.8708 20H17.8042V15.7L13.2042 16.7667C14.3042 17.9334 13.8708 20 13.8708 20Z"
          fill="#EBA352"
        />
        <path
          d="M14.2377 20H18.6377C18.6377 20 18.5711 17.8667 19.3044 16.0333L13.8044 16.8333C14.4377 18.4667 14.2377 20 14.2377 20ZM14.6711 14.1333H13.0044V6.73333C13.0044 6.23333 13.3711 5.83333 13.8377 5.83333C14.3044 5.83333 14.6711 6.23333 14.6711 6.76667V14.1333ZM16.6377 14.1333H14.6711V6.1C14.6711 5.5 15.1044 5 15.6711 5C16.2044 5 16.6711 5.5 16.6711 6.1V14.1333H16.6377Z"
          fill="#FFDD67"
        />
        <path
          d="M18.3376 14.1334H16.6042V6.56676C16.6042 6.03343 17.0042 5.6001 17.4709 5.6001C17.9376 5.6001 18.3376 6.03343 18.3376 6.56676V14.1334ZM19.1376 6.73343C19.5709 6.73343 19.9042 7.13343 19.9042 7.63343V14.1334H18.3376V7.63343C18.3376 7.13343 18.7042 6.73343 19.1376 6.73343Z"
          fill="#FFDD67"
        />
        <path
          d="M13.8377 5.8H14.0044C13.6044 5.86667 13.3044 6.26667 13.3044 6.7V14.1333H13.0044V6.73333C13.0044 6.23333 13.3711 5.8 13.8377 5.8ZM15.6377 5C15.7044 5 15.7377 5 15.7711 5.03333C15.3044 5.1 14.9377 5.56667 14.9377 6.1V11.4667L14.6377 11.8V6.1C14.6711 5.5 15.1044 5 15.6377 5ZM17.4711 5.6H17.6044C17.2044 5.66667 16.9044 6.06667 16.9044 6.53333V11.4333L16.6044 11.7667V6.56667C16.6377 6.03333 17.0044 5.6 17.4711 5.6ZM19.1377 6.73333C19.2044 6.73333 19.2377 6.73333 19.2711 6.76667C18.9044 6.83333 18.6377 7.2 18.6377 7.63333V11.4667L18.3377 11.8V7.63333C18.3377 7.13333 18.7044 6.73333 19.1377 6.73333Z"
          fill="#EBA352"
        />
        <path
          d="M10.2043 10.7333C10.7043 10.1666 11.7043 10.4333 12.4043 11.8999C12.9043 12.8999 13.0376 12.6999 13.3043 12.7666V11.8666C13.3043 11.8666 19.9376 11.4333 19.9376 12.4333C19.9376 12.4333 20.2376 14.8999 19.6043 16.4333C18.6376 18.7333 13.7043 19.3333 12.171 15.4333C11.871 14.6666 11.4376 13.8333 11.1043 12.9999C10.671 11.9999 9.63765 11.3999 10.2043 10.7333Z"
          fill="#FFDD67"
        />
        <path
          d="M10.5377 10.5C9.47102 11.3 11.4377 12.8333 12.371 15.2C13.7043 18.6 17.6043 18.6 19.2377 17.0333C17.7377 18.8 13.571 19.1333 12.171 15.4333C11.2377 13.0333 8.97102 11.2 10.5377 10.5Z"
          fill="#EBA352"
        />
        <path
          d="M13.0044 12.7334C14.3044 12.2667 17.0377 13.1667 16.6711 15.7667C16.6711 13.3334 14.5044 12.7667 13.3044 12.7667C13.1377 12.7667 13.0044 12.7334 13.0044 12.7334Z"
          fill="#EBA352"
        />
      </svg>
    </div>

    <!-- Emoji picker -->
    <div
      class="transition-svg-text reaction-item"
      (click)="showEmojiPicker = !showEmojiPicker"
    >
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <mask
          id="mask0_104646_17618"
          style="mask-type: alpha"
          maskUnits="userSpaceOnUse"
          x="0"
          y="0"
          width="24"
          height="24"
        >
          <rect width="24" height="24" fill="#D9D9D9" />
        </mask>
        <g mask="url(#mask0_104646_17618)">
          <path
            d="M12 22C10.6167 22 9.31667 21.7375 8.1 21.2125C6.88333 20.6875 5.825 19.975 4.925 19.075C4.025 18.175 3.3125 17.1167 2.7875 15.9C2.2625 14.6833 2 13.3833 2 12C2 10.6167 2.2625 9.31667 2.7875 8.1C3.3125 6.88333 4.025 5.825 4.925 4.925C5.825 4.025 6.88333 3.3125 8.1 2.7875C9.31667 2.2625 10.6167 2 12 2C12.75 2 13.4792 2.07917 14.1875 2.2375C14.8958 2.39583 15.5667 2.625 16.2 2.925C16.1333 3.09167 16.0833 3.26667 16.05 3.45C16.0167 3.63333 16 3.81667 16 4C16 4.23333 16.025 4.45417 16.075 4.6625C16.125 4.87083 16.1917 5.06667 16.275 5.25C15.6583 4.86667 14.9917 4.5625 14.275 4.3375C13.5583 4.1125 12.8 4 12 4C9.78333 4 7.89583 4.77917 6.3375 6.3375C4.77917 7.89583 4 9.78333 4 12C4 14.2167 4.77917 16.1042 6.3375 17.6625C7.89583 19.2208 9.78333 20 12 20C14.2167 20 16.1042 19.2208 17.6625 17.6625C19.2208 16.1042 20 14.2167 20 12C20 11.3333 19.9208 10.6917 19.7625 10.075C19.6042 9.45833 19.3833 8.875 19.1 8.325C19.3667 8.54167 19.6583 8.70833 19.975 8.825C20.2917 8.94167 20.6333 9 21 9C21.0833 9 21.1708 8.99583 21.2625 8.9875C21.3542 8.97917 21.4417 8.96667 21.525 8.95C21.675 9.43333 21.7917 9.92917 21.875 10.4375C21.9583 10.9458 22 11.4667 22 12C22 13.3833 21.7375 14.6833 21.2125 15.9C20.6875 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6875 15.9 21.2125C14.6833 21.7375 13.3833 22 12 22ZM15.5 11C15.9333 11 16.2917 10.8583 16.575 10.575C16.8583 10.2917 17 9.93333 17 9.5C17 9.06667 16.8583 8.70833 16.575 8.425C16.2917 8.14167 15.9333 8 15.5 8C15.0667 8 14.7083 8.14167 14.425 8.425C14.1417 8.70833 14 9.06667 14 9.5C14 9.93333 14.1417 10.2917 14.425 10.575C14.7083 10.8583 15.0667 11 15.5 11ZM8.5 11C8.93333 11 9.29167 10.8583 9.575 10.575C9.85833 10.2917 10 9.93333 10 9.5C10 9.06667 9.85833 8.70833 9.575 8.425C9.29167 8.14167 8.93333 8 8.5 8C8.06667 8 7.70833 8.14167 7.425 8.425C7.14167 8.70833 7 9.06667 7 9.5C7 9.93333 7.14167 10.2917 7.425 10.575C7.70833 10.8583 8.06667 11 8.5 11ZM12 17.5C13.1833 17.5 14.2292 17.175 15.1375 16.525C16.0458 15.875 16.7 15.0333 17.1 14H6.9C7.3 15.0333 7.95417 15.875 8.8625 16.525C9.77083 17.175 10.8167 17.5 12 17.5ZM20 5H19C18.7167 5 18.4792 4.90417 18.2875 4.7125C18.0958 4.52083 18 4.28333 18 4C18 3.71667 18.0958 3.47917 18.2875 3.2875C18.4792 3.09583 18.7167 3 19 3H20V2C20 1.71667 20.0958 1.47917 20.2875 1.2875C20.4792 1.09583 20.7167 1 21 1C21.2833 1 21.5208 1.09583 21.7125 1.2875C21.9042 1.47917 22 1.71667 22 2V3H23C23.2833 3 23.5208 3.09583 23.7125 3.2875C23.9042 3.47917 24 3.71667 24 4C24 4.28333 23.9042 4.52083 23.7125 4.7125C23.5208 4.90417 23.2833 5 23 5H22V6C22 6.28333 21.9042 6.52083 21.7125 6.7125C21.5208 6.90417 21.2833 7 21 7C20.7167 7 20.4792 6.90417 20.2875 6.7125C20.0958 6.52083 20 6.28333 20 6V5Z"
            fill="black"
          />
        </g>
      </svg>
    </div>

    <div
      (click)="openReplyPanel()"
      *ngIf="!isReply"
      class="transition-svg-text reaction-item"
    >
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <mask
          id="mask0_104646_17622"
          style="mask-type: alpha"
          maskUnits="userSpaceOnUse"
          x="0"
          y="0"
          width="24"
          height="24"
        >
          <rect width="24" height="24" fill="#D9D9D9" />
        </mask>
        <g mask="url(#mask0_104646_17622)">
          <path
            d="M7 14H17C17.2833 14 17.5207 13.904 17.712 13.712C17.904 13.5207 18 13.2833 18 13C18 12.7167 17.904 12.479 17.712 12.287C17.5207 12.0957 17.2833 12 17 12H7C6.71667 12 6.479 12.0957 6.287 12.287C6.09567 12.479 6 12.7167 6 13C6 13.2833 6.09567 13.5207 6.287 13.712C6.479 13.904 6.71667 14 7 14ZM7 11H17C17.2833 11 17.5207 10.904 17.712 10.712C17.904 10.5207 18 10.2833 18 10C18 9.71667 17.904 9.479 17.712 9.287C17.5207 9.09567 17.2833 9 17 9H7C6.71667 9 6.479 9.09567 6.287 9.287C6.09567 9.479 6 9.71667 6 10C6 10.2833 6.09567 10.5207 6.287 10.712C6.479 10.904 6.71667 11 7 11ZM7 8H17C17.2833 8 17.5207 7.90433 17.712 7.713C17.904 7.521 18 7.28333 18 7C18 6.71667 17.904 6.479 17.712 6.287C17.5207 6.09567 17.2833 6 17 6H7C6.71667 6 6.479 6.09567 6.287 6.287C6.09567 6.479 6 6.71667 6 7C6 7.28333 6.09567 7.521 6.287 7.713C6.479 7.90433 6.71667 8 7 8ZM20.3 20.3L18 18H4C3.45 18 2.97933 17.8043 2.588 17.413C2.196 17.021 2 16.55 2 16V4C2 3.45 2.196 2.979 2.588 2.587C2.97933 2.19567 3.45 2 4 2H20C20.55 2 21.021 2.19567 21.413 2.587C21.8043 2.979 22 3.45 22 4V19.575C22 20.025 21.796 20.3373 21.388 20.512C20.9793 20.6873 20.6167 20.6167 20.3 20.3ZM4 4V16H18.825L20 17.175V4H4Z"
            fill="black"
          />
        </g>
      </svg>
    </div>

    <div
      (click)="toggleEditMessagePopup()"
      *ngIf="!isContact"
      class="transition-svg-text reaction-item"
    >
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <mask
          id="mask0_104646_17626"
          style="mask-type: alpha"
          maskUnits="userSpaceOnUse"
          x="0"
          y="0"
          width="24"
          height="24"
        >
          <rect width="24" height="24" fill="#D9D9D9" />
        </mask>
        <g mask="url(#mask0_104646_17626)">
          <path
            d="M12 20C11.45 20 10.9792 19.8042 10.5875 19.4125C10.1958 19.0208 10 18.55 10 18C10 17.45 10.1958 16.9792 10.5875 16.5875C10.9792 16.1958 11.45 16 12 16C12.55 16 13.0208 16.1958 13.4125 16.5875C13.8042 16.9792 14 17.45 14 18C14 18.55 13.8042 19.0208 13.4125 19.4125C13.0208 19.8042 12.55 20 12 20ZM12 14C11.45 14 10.9792 13.8042 10.5875 13.4125C10.1958 13.0208 10 12.55 10 12C10 11.45 10.1958 10.9792 10.5875 10.5875C10.9792 10.1958 11.45 10 12 10C12.55 10 13.0208 10.1958 13.4125 10.5875C13.8042 10.9792 14 11.45 14 12C14 12.55 13.8042 13.0208 13.4125 13.4125C13.0208 13.8042 12.55 14 12 14ZM12 8C11.45 8 10.9792 7.80417 10.5875 7.4125C10.1958 7.02083 10 6.55 10 6C10 5.45 10.1958 4.97917 10.5875 4.5875C10.9792 4.19583 11.45 4 12 4C12.55 4 13.0208 4.19583 13.4125 4.5875C13.8042 4.97917 14 5.45 14 6C14 6.55 13.8042 7.02083 13.4125 7.4125C13.0208 7.80417 12.55 8 12 8Z"
            fill="#1C1B1F"
          />
        </g>
      </svg>

      <!-- message details popup -->

      <div
        (click)="$event.stopPropagation()"
        class="px-[20px] py-[10px] w-[max-content] rounded-[30px] shadow-[0px_6px_14px_0px_#00000033] rounded-tl-[0px] top-[110%] md:top-[50%] left-[0%] md:left-[100%] cursor-default transition-svg-text bg-white absolute z-[10000]"
        [ngClass]="{
          'scale-0': !editMessagePopupOpen,
          'scale-100': editMessagePopupOpen
        }"
      >
        <!-- edit message btn -->
        <div
          (click)="setCurrentEditMessageId()"
          class="flex items-center justify-center px-[20px] py-[10px] rounded-[100px] hover-primary-bg transition-svg-text cursor-pointer"
        >
          <p class="text-[18px] font-semibold select-none">
            Nachricht bearbeiten
          </p>
        </div>
      </div>
    </div>
  </div>

  <div
    [attr.data-message-id]="messageId"
    *ngIf="currentEditMessageId !== messageId"
    class="flex flex-col gap-[10px]"
    [ngClass]="{
      'items-start md:pr-[20px] lg:pr-[80px]': isContact,
      'items-end md:pl-[20px] lg:pl-[80px] ': !isContact
    }"
  >
    <!-- name and time -->
    <div
      class="flex items-center justify-end gap-[20px]"
      [ngClass]="{ 'flex-row-reverse': isContact }"
    >
      <p class="text-[14px] text-disable">{{ time }}</p>

      <p
        (click)="openProfilePopup()"
        *ngIf="isContact"
        class="hover-primary transition-svg-text text-[18px] font-bold"
      >
        {{ name }}
      </p>

      <p
        *ngIf="!isContact"
        (click)="openProfilePopup()"
        class="hover-primary transition-svg-text text-[18px] font-bold"
      >
        {{ name }}
      </p>
    </div>

    <!-- message -->
    <p
      class="text-[17px] flex-wrap md:text-[18px] break-all rounded-[30px] p-[15px] flex justify-end items-center transition-svg-text"
      [ngClass]="{
        'rounded-tl-[0px] bg-bg text-black contact-message': isContact,
        'rounded-tr-[0px] bg-chat text-white': !isContact
      }"
      [innerHTML]="formatMessage(message)"
    ></p>

    <!-- EMOJI CONTAINER -->
    <div
      *ngIf="likes?.length || [].length > 0"
      class="flex items-center relative gap-[8px] flex-wrap"
    >
      <!-- EMOJI RENDERN -->
      @for (like of sortedLikes(); track $index) { @if(like.count > 0) {
      <div
        *ngIf="likes?.length || [].length > 0"
        class="emoji relative cursor-pointer flex items-center gap-[10px] border-[1px] border-lines rounded-[20px] py-[5px] px-[10px]"
        (click)="
          $event.stopPropagation();
          reactOnEmoji(
            like.emoji,
            loggedInUser?.id || '',
            messageId,
            isDirectChat ? currentDirectChat.id || '' : currentChannel.id,
            likes
          )
        "
      >
        <span>{{ like.emoji }}</span>
        <span class="text-[16px]">{{ like.count }}</span>

        <app-emoji-hover-display
          [emoji]="like.emoji"
          [likers]="like.userIds"
          [firstLike]="returnFirstLike(like)"
          class="emoji-hover-popup absolute"
        ></app-emoji-hover-display>
      </div>
      } }

      <!-- Floating Popup -->

      <!-- add Emoji-btn -->
      <div
        class="add-icon-btn bg-white p-[5px] rounded-full hover-primary-bg transition-svg-text scale-90 hover:scale-100"
      >
        <svg
          width="25"
          height="24"
          viewBox="0 0 25 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
          (click)="showEmojiPicker = !showEmojiPicker"
        >
          <mask
            id="mask0_104638_16403"
            style="mask-type: alpha"
            maskUnits="userSpaceOnUse"
            x="0"
            y="0"
            width="25"
            height="24"
          >
            <rect x="0.036377" width="24" height="24" fill="#D9D9D9" />
          </mask>
          <g mask="url(#mask0_104638_16403)">
            <path
              d="M12.0364 22C10.653 22 9.35304 21.7375 8.13638 21.2125C6.91971 20.6875 5.86138 19.975 4.96138 19.075C4.06138 18.175 3.34888 17.1167 2.82388 15.9C2.29888 14.6833 2.03638 13.3833 2.03638 12C2.03638 10.6167 2.29888 9.31667 2.82388 8.1C3.34888 6.88333 4.06138 5.825 4.96138 4.925C5.86138 4.025 6.91971 3.3125 8.13638 2.7875C9.35304 2.2625 10.653 2 12.0364 2C12.7864 2 13.5155 2.07917 14.2239 2.2375C14.9322 2.39583 15.603 2.625 16.2364 2.925C16.1697 3.09167 16.1197 3.26667 16.0864 3.45C16.053 3.63333 16.0364 3.81667 16.0364 4C16.0364 4.23333 16.0614 4.45417 16.1114 4.6625C16.1614 4.87083 16.228 5.06667 16.3114 5.25C15.6947 4.86667 15.028 4.5625 14.3114 4.3375C13.5947 4.1125 12.8364 4 12.0364 4C9.81971 4 7.93221 4.77917 6.37388 6.3375C4.81554 7.89583 4.03638 9.78333 4.03638 12C4.03638 14.2167 4.81554 16.1042 6.37388 17.6625C7.93221 19.2208 9.81971 20 12.0364 20C14.253 20 16.1405 19.2208 17.6989 17.6625C19.2572 16.1042 20.0364 14.2167 20.0364 12C20.0364 11.3333 19.9572 10.6917 19.7989 10.075C19.6405 9.45833 19.4197 8.875 19.1364 8.325C19.403 8.54167 19.6947 8.70833 20.0114 8.825C20.328 8.94167 20.6697 9 21.0364 9C21.1197 9 21.2072 8.99583 21.2989 8.9875C21.3905 8.97917 21.478 8.96667 21.5614 8.95C21.7114 9.43333 21.828 9.92917 21.9114 10.4375C21.9947 10.9458 22.0364 11.4667 22.0364 12C22.0364 13.3833 21.7739 14.6833 21.2489 15.9C20.7239 17.1167 20.0114 18.175 19.1114 19.075C18.2114 19.975 17.153 20.6875 15.9364 21.2125C14.7197 21.7375 13.4197 22 12.0364 22ZM15.5364 11C15.9697 11 16.328 10.8583 16.6114 10.575C16.8947 10.2917 17.0364 9.93333 17.0364 9.5C17.0364 9.06667 16.8947 8.70833 16.6114 8.425C16.328 8.14167 15.9697 8 15.5364 8C15.103 8 14.7447 8.14167 14.4614 8.425C14.178 8.70833 14.0364 9.06667 14.0364 9.5C14.0364 9.93333 14.178 10.2917 14.4614 10.575C14.7447 10.8583 15.103 11 15.5364 11ZM8.53638 11C8.96971 11 9.32804 10.8583 9.61138 10.575C9.89471 10.2917 10.0364 9.93333 10.0364 9.5C10.0364 9.06667 9.89471 8.70833 9.61138 8.425C9.32804 8.14167 8.96971 8 8.53638 8C8.10304 8 7.74471 8.14167 7.46138 8.425C7.17804 8.70833 7.03638 9.06667 7.03638 9.5C7.03638 9.93333 7.17804 10.2917 7.46138 10.575C7.74471 10.8583 8.10304 11 8.53638 11ZM12.0364 17.5C13.2197 17.5 14.2655 17.175 15.1739 16.525C16.0822 15.875 16.7364 15.0333 17.1364 14H6.93638C7.33638 15.0333 7.99054 15.875 8.89888 16.525C9.80721 17.175 10.853 17.5 12.0364 17.5ZM20.0364 5H19.0364C18.753 5 18.5155 4.90417 18.3239 4.7125C18.1322 4.52083 18.0364 4.28333 18.0364 4C18.0364 3.71667 18.1322 3.47917 18.3239 3.2875C18.5155 3.09583 18.753 3 19.0364 3H20.0364V2C20.0364 1.71667 20.1322 1.47917 20.3239 1.2875C20.5155 1.09583 20.753 1 21.0364 1C21.3197 1 21.5572 1.09583 21.7489 1.2875C21.9405 1.47917 22.0364 1.71667 22.0364 2V3H23.0364C23.3197 3 23.5572 3.09583 23.7489 3.2875C23.9405 3.47917 24.0364 3.71667 24.0364 4C24.0364 4.28333 23.9405 4.52083 23.7489 4.7125C23.5572 4.90417 23.3197 5 23.0364 5H22.0364V6C22.0364 6.28333 21.9405 6.52083 21.7489 6.7125C21.5572 6.90417 21.3197 7 21.0364 7C20.753 7 20.5155 6.90417 20.3239 6.7125C20.1322 6.52083 20.0364 6.28333 20.0364 6V5Z"
              fill="black"
            />
          </g>
        </svg>
      </div>
    </div>

    <!-- answer btn container -->
    <div
      *ngIf="numberOfAnswers > 0 && !isReply"
      class="flex items-center gap-[20px] flex-wrap"
    >
      <p
        (click)="$event.stopPropagation(); openReplyPanel()"
        class="text-primary text-[18px] hover:font-bold hover:cursor-pointer"
      >
        <span> {{ numberOfAnswers }} </span> Antworten
      </p>

      <p class="text-[14px] text-disable">
        Letzte Antwort <span> {{ lastAnswerTime }} </span>
      </p>
    </div>
  </div>

  <!-- edit message -->
  <div
    (click)="editMessage.focus()"
    *ngIf="currentEditMessageId === messageId"
    class="w-full md:pl-[20px] lg:pl-[80px]"
  >
    <div
      class="w-full h-full p-[20px] rounded-[20px] bg-white flex flex-col gap-[16px] border-[1px] border-lines"
    >
      <textarea
        [(ngModel)]="editedMessage"
        #editMessage
        class="w-full max-h-[220px] outline-none resize-none"
        [style.height]="'auto'"
        [style.height.px]="editMessage.scrollHeight"
        placeholder="{{ message }}"
        (input)="adjustTextareaHeight()"
        (keydown)="onKeyDown($event)"
      ></textarea>

      <div
        class="flex flex-wrap items-center justify-between gap-[20px] w-full"
      >
        <!-- emoji btn -->
        <div
          class="transition-svg-text hover-primary-bg p-[5px] rounded-full hover:scale-110"
        >
          <svg
            width="24"
            height="25"
            viewBox="0 0 24 25"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            (click)="showEmojiPicker = !showEmojiPicker"
          >
            <mask
              id="mask0_112248_10059"
              style="mask-type: alpha"
              maskUnits="userSpaceOnUse"
              x="0"
              y="0"
              width="24"
              height="25"
            >
              <rect y="0.5" width="24" height="24" fill="#D9D9D9" />
            </mask>
            <g mask="url(#mask0_112248_10059)">
              <path
                d="M15.5 11.5C15.9333 11.5 16.2917 11.3583 16.575 11.075C16.8583 10.7917 17 10.4333 17 10C17 9.56667 16.8583 9.20833 16.575 8.925C16.2917 8.64167 15.9333 8.5 15.5 8.5C15.0667 8.5 14.7083 8.64167 14.425 8.925C14.1417 9.20833 14 9.56667 14 10C14 10.4333 14.1417 10.7917 14.425 11.075C14.7083 11.3583 15.0667 11.5 15.5 11.5ZM8.5 11.5C8.93333 11.5 9.29167 11.3583 9.575 11.075C9.85833 10.7917 10 10.4333 10 10C10 9.56667 9.85833 9.20833 9.575 8.925C9.29167 8.64167 8.93333 8.5 8.5 8.5C8.06667 8.5 7.70833 8.64167 7.425 8.925C7.14167 9.20833 7 9.56667 7 10C7 10.4333 7.14167 10.7917 7.425 11.075C7.70833 11.3583 8.06667 11.5 8.5 11.5ZM12 18C12.95 18 13.8167 17.7877 14.6 17.363C15.3833 16.9377 15.9917 16.4 16.425 15.75C16.625 15.45 16.6543 15.1667 16.513 14.9C16.371 14.6333 16.15 14.5 15.85 14.5C15.7333 14.5 15.6167 14.5333 15.5 14.6C15.3833 14.6667 15.2917 14.75 15.225 14.85C14.8583 15.35 14.4 15.75 13.85 16.05C13.3 16.35 12.6833 16.5 12 16.5C11.3167 16.5 10.7 16.35 10.15 16.05C9.6 15.75 9.14167 15.35 8.775 14.85C8.70833 14.75 8.61267 14.6667 8.488 14.6C8.36267 14.5333 8.24167 14.5 8.125 14.5C7.84167 14.5 7.62933 14.629 7.488 14.887C7.346 15.1457 7.36667 15.4167 7.55 15.7C8 16.3833 8.61667 16.9377 9.4 17.363C10.1833 17.7877 11.05 18 12 18ZM12 22.5C10.6167 22.5 9.31667 22.2373 8.1 21.712C6.88333 21.1873 5.825 20.475 4.925 19.575C4.025 18.675 3.31267 17.6167 2.788 16.4C2.26267 15.1833 2 13.8833 2 12.5C2 11.1167 2.26267 9.81667 2.788 8.6C3.31267 7.38333 4.025 6.325 4.925 5.425C5.825 4.525 6.88333 3.81233 8.1 3.287C9.31667 2.76233 10.6167 2.5 12 2.5C13.3833 2.5 14.6833 2.76233 15.9 3.287C17.1167 3.81233 18.175 4.525 19.075 5.425C19.975 6.325 20.6873 7.38333 21.212 8.6C21.7373 9.81667 22 11.1167 22 12.5C22 13.8833 21.7373 15.1833 21.212 16.4C20.6873 17.6167 19.975 18.675 19.075 19.575C18.175 20.475 17.1167 21.1873 15.9 21.712C14.6833 22.2373 13.3833 22.5 12 22.5ZM12 20.5C14.2167 20.5 16.1043 19.721 17.663 18.163C19.221 16.6043 20 14.7167 20 12.5C20 10.2833 19.221 8.39567 17.663 6.837C16.1043 5.279 14.2167 4.5 12 4.5C9.78333 4.5 7.896 5.279 6.338 6.837C4.77933 8.39567 4 10.2833 4 12.5C4 14.7167 4.77933 16.6043 6.338 18.163C7.896 19.721 9.78333 20.5 12 20.5Z"
                fill="#686868"
              />
            </g>
          </svg>
        </div>

        <div class="flex flex-wrap items-center gap-[20px]">
          <button
            class="bg-white text-primary border-[1px] border-primary hover:text-white"
            (click)="resetEditMessage()"
          >
            Abbrechen
          </button>

          <button (click)="saveEditedMessage()">Speichern</button>
        </div>
      </div>
    </div>
  </div>

  <img
    class="max-w-[50px] max-h-[50px] w-[50px] h-[50px] md:max-w-[60px] md:max-h-[60px] md:w-[60px] md:h-[60px] lg:max-w-[70px] lg:max-h-[70px] lg:w-[70px] lg:h-[70px] rounded-full"
    src="{{ imgUrl || '' }}"
    (error)="globalVariablesService.handleImageError($event)"
    alt=""
  />
</div>

<app-emoji-picker
  class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50"
  *ngIf="showEmojiPicker"
  [messageId]="
    !this.isFirstReply && this.isReply
      ? this.parentElement?.id
      : this.messageObj?.id
  "
  [channelId]="isDirectChat ? currentDirectChat.id || '' : currentChannel.id"
  [replyId]="messageId"
  [emojiInput$]="emojiInput$"
  [messageLikes]="getMessageLikes()"
  [replyLikes]="getReplyLikes()"
  [showEmojiPicker]="showEmojiPicker"
  (showEmojiPickerChange)="showEmojiPicker = $event"
  [isReply]="isReply"
  [isDirectChat]="isDirectChat"
  [isFirstReply]="isFirstReply"
  [editMessage]="currentEditMessageId === messageId"
  (emojiSelectedEvent)="insertEmoji($event)"
>
</app-emoji-picker>
