<section
  class="flex pb-[32px] rounded-[0px] md:rounded-[30px] h-full md:ml-4 bg-white relative overflow-hidden"
>
  <header
    class="z-[9] bg-white flex justify-between items-center px-[16px] md:px-[40px] py-[15px] md:py-[25px] absolute top-0 left-0 w-full shadow-[0px_2px_10px_0px_#00000014]"
    [ngClass]="{
      'max-h-[60px] md:max-h-[100px] min-h-[60px] md:min-h-[100px]':
        !isDirectChat,
      'min-h-[80px] md:min-h-[110px]': isDirectChat
    }"
  >
    <div class="flex items-center gap-[5px] py-[6px]">
      <h2 class="text-[24px] font-bold">Thread</h2>

      <svg
        *ngIf="!isDirectChat"
        width="16"
        height="16"
        viewBox="0 0 16 16"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <mask
          id="mask0_210_922"
          style="mask-type: alpha"
          maskUnits="userSpaceOnUse"
          x="0"
          y="0"
          width="16"
          height="16"
        >
          <rect width="16" height="16" fill="#D9D9D9" />
        </mask>
        <g mask="url(#mask0_210_922)">
          <path
            d="M4.8333 13.3333C4.62219 13.3333 4.44997 13.25 4.31663 13.0833C4.1833 12.9166 4.14441 12.7333 4.19997 12.5333L4.66663 10.6666H3.1833C2.96108 10.6666 2.7833 10.5806 2.64997 10.4086C2.51663 10.2362 2.47774 10.0444 2.5333 9.83329C2.56663 9.67774 2.64441 9.55551 2.76663 9.46663C2.88885 9.37774 3.02774 9.33329 3.1833 9.33329H4.99997L5.66663 6.66663H3.84997C3.62774 6.66663 3.44997 6.58063 3.31663 6.40863C3.1833 6.23618 3.14441 6.0444 3.19997 5.83329C3.2333 5.67774 3.31108 5.55551 3.4333 5.46663C3.55552 5.37774 3.69441 5.33329 3.84997 5.33329H5.99997L6.54997 3.14996C6.5833 3.00551 6.65552 2.88885 6.76663 2.79996C6.87774 2.71107 7.01108 2.66663 7.16663 2.66663C7.37774 2.66663 7.54997 2.74996 7.6833 2.91663C7.81663 3.08329 7.85552 3.26663 7.79997 3.46663L7.3333 5.33329H9.99997L10.55 3.14996C10.5833 3.00551 10.6555 2.88885 10.7666 2.79996C10.8777 2.71107 11.0111 2.66663 11.1666 2.66663C11.3777 2.66663 11.55 2.74996 11.6833 2.91663C11.8166 3.08329 11.8555 3.26663 11.8 3.46663L11.3333 5.33329H12.8166C13.0389 5.33329 13.2166 5.41929 13.35 5.59129C13.4833 5.76374 13.5222 5.95551 13.4666 6.16663C13.4333 6.32218 13.3555 6.4444 13.2333 6.53329C13.1111 6.62218 12.9722 6.66663 12.8166 6.66663H11L10.3333 9.33329H12.15C12.3722 9.33329 12.55 9.41929 12.6833 9.59129C12.8166 9.76374 12.8555 9.95551 12.8 10.1666C12.7666 10.3222 12.6889 10.4444 12.5666 10.5333C12.4444 10.6222 12.3055 10.6666 12.15 10.6666H9.99997L9.44997 12.85C9.41663 12.9944 9.34441 13.1111 9.2333 13.2C9.12219 13.2888 8.98885 13.3333 8.8333 13.3333C8.62219 13.3333 8.44997 13.25 8.31663 13.0833C8.1833 12.9166 8.14441 12.7333 8.19997 12.5333L8.66663 10.6666H5.99997L5.44997 12.85C5.41663 12.9944 5.34441 13.1111 5.2333 13.2C5.12219 13.2888 4.98885 13.3333 4.8333 13.3333ZM6.3333 9.33329H8.99997L9.66663 6.66663H6.99997L6.3333 9.33329Z"
            fill="#797EF3"
          />
        </g>
      </svg>

      <p *ngIf="!isDirectChat" class="text-primary">
        {{ currentChannel.name || "lädt..." }}
      </p>
      <p *ngIf="isDirectChat" class="text-primary">
        {{ " @ " + currentDirectChatUser.name || "lädt..." }}
      </p>
    </div>

    <div
      (click)="panelService.closeReplyPanel()"
      class="hover-primary-bg text-svg-text rounded-full p-[5px] transition-svg-text"
    >
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <mask
          id="mask0_105063_10949"
          style="mask-type: alpha"
          maskUnits="userSpaceOnUse"
          x="0"
          y="0"
          width="24"
          height="24"
        >
          <rect width="24" height="24" fill="#D9D9D9" />
        </mask>
        <g mask="url(#mask0_105063_10949)">
          <path
            d="M12 13.4L7.10005 18.3C6.91672 18.4833 6.68338 18.575 6.40005 18.575C6.11672 18.575 5.88338 18.4833 5.70005 18.3C5.51672 18.1167 5.42505 17.8833 5.42505 17.6C5.42505 17.3167 5.51672 17.0833 5.70005 16.9L10.6 12L5.70005 7.09999C5.51672 6.91665 5.42505 6.68332 5.42505 6.39999C5.42505 6.11665 5.51672 5.88332 5.70005 5.69999C5.88338 5.51665 6.11672 5.42499 6.40005 5.42499C6.68338 5.42499 6.91672 5.51665 7.10005 5.69999L12 10.6L16.9 5.69999C17.0834 5.51665 17.3167 5.42499 17.6 5.42499C17.8834 5.42499 18.1167 5.51665 18.3 5.69999C18.4834 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4834 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4834 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4834 18.1167 18.3 18.3C18.1167 18.4833 17.8834 18.575 17.6 18.575C17.3167 18.575 17.0834 18.4833 16.9 18.3L12 13.4Z"
            fill="black"
          />
        </g>
      </svg>
    </div>
  </header>

  <main class="w-full h-full flex flex-col justify-end">
    <div
      #chatContainer
      class="reply-chat-messages-container overflow-y-auto overflow-x-hidden flex flex-col gap-[30px] pt-[45px] pb-[20px]"
      [ngClass]="{
        'mt-[60px] md:mt-[100px]': !isDirectChat,
        'mt-[80px] md:mt-[110px]': isDirectChat
      }"
    >
      <app-user-message
        [message]="panelService.message"
        [time]="panelService.time"
        [name]="panelService.name"
        [imgUrl]="panelService.imgUrl"
        [isContact]="panelService.isContact"
        [lastAnswerTime]="'00:00 Uhr'"
        [isReplay]="true"
        [userId]="panelService.userId"
        [isFirstReply]="true"
      ></app-user-message>

      <div class="relative text-lines mx-[30px] flex items-center gap-[10px]">
        <div class="line"></div>

        <p class="bg-white relative z-[9] pr-[20px]">
          <span>{{ panelService.numberOfAnswers }}</span>
          Antworten
        </p>
      </div>

      @if(!isDirectChat) {

      <app-user-message
        *ngFor="let reply of getRepliesForMessage(currentReplyMessageId)"
        [message]="reply.message"
        [time]="channelService.formatTime(reply.timestamp)"
        [name]="
          getUserNameAndScroll(
            reply.userId,
            reply,
            getRepliesForMessage(currentReplyMessageId)
          )
        "
        [imgUrl]="getImgUrl(reply.userId)"
        [isContact]="checkIfContact(reply.userId)"
        [isReplay]="true"
        [userId]="reply.userId"
        [replyId]="reply.id"
        [likes]="reply.likes || []"
        [messageId]="currentReplyMessageId"
        [channelId]="currentChannel.id"
        [isDirectChat]="isDirectChat" 
      ></app-user-message>

      } @if(isDirectChat) {

      <app-user-message
        *ngFor="
          let reply of getDirectChatRepliesForMessage(currentReplyMessageId)
        "
        [message]="reply.message"
        [time]="channelService.formatTime(reply.timestamp)"
        [name]="
          getUserNameAndScroll(
            reply.userId,
            reply,
            getDirectChatRepliesForMessage(currentReplyMessageId)
          )
        "
        [imgUrl]="getImgUrl(reply.userId)"
        [isContact]="checkIfContact(reply.userId)"
        [isReplay]="true"
        [userId]="reply.id"
        [messageId]="currentReplyMessageId"
        [isDirectChat]="isDirectChat" 
      ></app-user-message>

      }
    </div>

    <!-- input -->
    <app-message-input
      [isReplayInput]="true"
      class="px-[15px]"
      [replyPanelComponent]="this"
    ></app-message-input>
  </main>
</section>
