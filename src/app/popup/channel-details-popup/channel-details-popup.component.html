<section class="channel-details-popup flex flex-col gap-[20px]">
  <div
    class="flex justify-between items-center w-full sticky xl:static top-[0px] xl:top-[unset] z-[10000] xl:z-[unset] bg-white"
    [ngClass]="{
      'shadow-[0px_2px_10px_0px_#00000014] pt-[40px] pb-[20px] px-[16px]':
        isTablet
    }"
  >
    <div class="flex items-center gap-[15px]">
      <svg
        width="30"
        height="31"
        viewBox="0 0 30 31"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <mask
          id="mask0_364_2314"
          style="mask-type: alpha"
          maskUnits="userSpaceOnUse"
          x="0"
          y="0"
          width="30"
          height="31"
        >
          <rect y="0.5" width="30" height="30" fill="#D9D9D9" />
        </mask>
        <g mask="url(#mask0_364_2314)">
          <path
            d="M9.0625 25.5C8.66666 25.5 8.34375 25.3438 8.09375 25.0312C7.84375 24.7188 7.77083 24.375 7.875 24L8.75 20.5H5.96875C5.55208 20.5 5.21875 20.3387 4.96875 20.0162C4.71875 19.6929 4.64583 19.3333 4.75 18.9375C4.8125 18.6458 4.95833 18.4167 5.1875 18.25C5.41666 18.0833 5.67708 18 5.96875 18H9.375L10.625 13H7.21875C6.80208 13 6.46875 12.8387 6.21875 12.5162C5.96875 12.1929 5.89583 11.8333 6 11.4375C6.0625 11.1458 6.20833 10.9167 6.4375 10.75C6.66666 10.5833 6.92708 10.5 7.21875 10.5H11.25L12.2812 6.40625C12.3437 6.13542 12.4792 5.91667 12.6875 5.75C12.8958 5.58333 13.1458 5.5 13.4375 5.5C13.8333 5.5 14.1562 5.65625 14.4062 5.96875C14.6562 6.28125 14.7292 6.625 14.625 7L13.75 10.5H18.75L19.7812 6.40625C19.8437 6.13542 19.9792 5.91667 20.1875 5.75C20.3958 5.58333 20.6458 5.5 20.9375 5.5C21.3333 5.5 21.6562 5.65625 21.9062 5.96875C22.1562 6.28125 22.2292 6.625 22.125 7L21.25 10.5H24.0312C24.4479 10.5 24.7812 10.6613 25.0312 10.9838C25.2812 11.3071 25.3542 11.6667 25.25 12.0625C25.1875 12.3542 25.0417 12.5833 24.8125 12.75C24.5833 12.9167 24.3229 13 24.0312 13H20.625L19.375 18H22.7812C23.1979 18 23.5312 18.1613 23.7812 18.4838C24.0312 18.8071 24.1042 19.1667 24 19.5625C23.9375 19.8542 23.7917 20.0833 23.5625 20.25C23.3333 20.4167 23.0729 20.5 22.7812 20.5H18.75L17.7187 24.5938C17.6562 24.8646 17.5208 25.0833 17.3125 25.25C17.1042 25.4167 16.8542 25.5 16.5625 25.5C16.1667 25.5 15.8437 25.3438 15.5937 25.0312C15.3437 24.7188 15.2708 24.375 15.375 24L16.25 20.5H11.25L10.2187 24.5938C10.1562 24.8646 10.0208 25.0833 9.8125 25.25C9.60416 25.4167 9.35416 25.5 9.0625 25.5ZM11.875 18H16.875L18.125 13H13.125L11.875 18Z"
            fill="black"
          />
        </g>
      </svg>

      <h2 class="text-[24px] font-bold">
        {{ currentChannel.name || "lädt..." }}
      </h2>
    </div>

    <div
      (click)="closePopup()"
      class="hover-primary-bg rounded-full p-[5px] transition-svg-text"
    >
      <svg
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <mask
          id="mask0_105201_6560"
          style="mask-type: alpha"
          maskUnits="userSpaceOnUse"
          x="0"
          y="0"
          width="24"
          height="24"
        >
          <rect width="24" height="24" fill="#D9D9D9" />
        </mask>
        <g mask="url(#mask0_105201_6560)">
          <path
            d="M12 13.4L7.10005 18.3C6.91672 18.4833 6.68338 18.575 6.40005 18.575C6.11672 18.575 5.88338 18.4833 5.70005 18.3C5.51672 18.1167 5.42505 17.8833 5.42505 17.6C5.42505 17.3167 5.51672 17.0833 5.70005 16.9L10.6 12L5.70005 7.09999C5.51672 6.91665 5.42505 6.68332 5.42505 6.39999C5.42505 6.11665 5.51672 5.88332 5.70005 5.69999C5.88338 5.51665 6.11672 5.42499 6.40005 5.42499C6.68338 5.42499 6.91672 5.51665 7.10005 5.69999L12 10.6L16.9 5.69999C17.0834 5.51665 17.3167 5.42499 17.6 5.42499C17.8834 5.42499 18.1167 5.51665 18.3 5.69999C18.4834 5.88332 18.575 6.11665 18.575 6.39999C18.575 6.68332 18.4834 6.91665 18.3 7.09999L13.4 12L18.3 16.9C18.4834 17.0833 18.575 17.3167 18.575 17.6C18.575 17.8833 18.4834 18.1167 18.3 18.3C18.1167 18.4833 17.8834 18.575 17.6 18.575C17.3167 18.575 17.0834 18.4833 16.9 18.3L12 13.4Z"
            fill="black"
          />
        </g>
      </svg>
    </div>
  </div>

  <div
    class="pb-[20px] px-[16px] xl:pb-[0px] xl:px-[0px] flex flex-col gap-[20px]"
  >
    <div
      class="flex flex-col gap-[20px] rounded-[20px] transition-svg-text"
      [ngClass]="{
        'border border-lines p-[20px]': !editChannelName
      }"
    >
      <div class="flex justify-between items-center w-full">
        <h3 class="text-[18px] font-bold">Channel-Name</h3>

        <p
          *ngIf="
            !editChannelName &&
            currentChannel.channelCreatorId === loggedInUser?.id
          "
          (click)="editChannelName = true"
          class="text-hover hover:font-bold cursor-pointer transition-svg-text"
        >
          Bearbeiten
        </p>
        <p
          *ngIf="editChannelName"
          (click)="editChannelNameFunction()"
          class="text-hover hover:font-bold cursor-pointer transition-svg-text"
        >
          Speichern
        </p>
      </div>

      <div
        *ngIf="editChannelName"
        (click)="channelName.focus()"
        class="popup-input-container"
      >
        <svg
          width="23"
          height="24"
          viewBox="0 0 23 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <mask
            id="mask0_105201_6568"
            style="mask-type: alpha"
            maskUnits="userSpaceOnUse"
            x="0"
            y="0"
            width="23"
            height="24"
          >
            <rect y="0.5" width="23" height="23" fill="#D9D9D9" />
          </mask>
          <g mask="url(#mask0_105201_6568)">
            <path
              d="M6.94787 19.6666C6.64439 19.6666 6.39683 19.5469 6.20516 19.3073C6.01349 19.0677 5.95759 18.8041 6.03745 18.5166L6.70828 15.8333H4.57599C4.25655 15.8333 4.00099 15.7097 3.80933 15.4624C3.61766 15.2145 3.56176 14.9389 3.64162 14.6354C3.68953 14.4118 3.80134 14.2361 3.97703 14.1083C4.15273 13.9805 4.35238 13.9166 4.57599 13.9166H7.18745L8.14578 10.0833H5.53433C5.21488 10.0833 4.95933 9.95969 4.76766 9.71244C4.57599 9.46455 4.52009 9.18887 4.59995 8.8854C4.64787 8.66179 4.75967 8.48609 4.93537 8.35831C5.11106 8.23054 5.31071 8.16665 5.53433 8.16665H8.62495L9.41558 5.0281C9.46349 4.82047 9.56731 4.65276 9.72703 4.52498C9.88676 4.3972 10.0784 4.33331 10.302 4.33331C10.6055 4.33331 10.8531 4.4531 11.0447 4.69269C11.2364 4.93227 11.2923 5.19581 11.2125 5.48331L10.5416 8.16665H14.375L15.1656 5.0281C15.2135 4.82047 15.3173 4.65276 15.477 4.52498C15.6368 4.3972 15.8284 4.33331 16.052 4.33331C16.3555 4.33331 16.6031 4.4531 16.7947 4.69269C16.9864 4.93227 17.0423 5.19581 16.9625 5.48331L16.2916 8.16665H18.4239C18.7434 8.16665 18.9989 8.29027 19.1906 8.53752C19.3822 8.78541 19.4381 9.06109 19.3583 9.36456C19.3104 9.58817 19.1986 9.76387 19.0229 9.89165C18.8472 10.0194 18.6475 10.0833 18.4239 10.0833H15.8125L14.8541 13.9166H17.4656C17.785 13.9166 18.0406 14.0403 18.2322 14.2875C18.4239 14.5354 18.4798 14.8111 18.4 15.1146C18.352 15.3382 18.2402 15.5139 18.0645 15.6416C17.8888 15.7694 17.6892 15.8333 17.4656 15.8333H14.375L13.5843 18.9719C13.5364 19.1795 13.4326 19.3472 13.2729 19.475C13.1131 19.6028 12.9215 19.6666 12.6979 19.6666C12.3944 19.6666 12.1468 19.5469 11.9552 19.3073C11.7635 19.0677 11.7076 18.8041 11.7875 18.5166L12.4583 15.8333H8.62495L7.83433 18.9719C7.78641 19.1795 7.68259 19.3472 7.52287 19.475C7.36314 19.6028 7.17148 19.6666 6.94787 19.6666ZM9.10412 13.9166H12.9375L13.8958 10.0833H10.0625L9.10412 13.9166Z"
              fill="#686868"
            />
          </g>
        </svg>

        <input
          [(ngModel)]="channelNameInput"
          #channelName
          type="text"
          placeholder="{{ currentChannel.name || 'Channel-Name' }}"
        />
      </div>

      <p
        *ngIf="channelNameInputTooLong || channelNameExistsError"
        class="text-error mt-[-10px]"
      >
        <span *ngIf="channelNameInputTooLong">
          Der Channel Name ist zu lang. Bitte geben Sie einen kürzeren Namen ein
        </span>
        <span *ngIf="channelNameExistsError">
          Dieser Channel Name existiert bereits
        </span>
      </p>

      <div *ngIf="!editChannelName" class="flex items-center gap-[10px]">
        <svg
          width="23"
          height="24"
          viewBox="0 0 23 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <mask
            id="mask0_105201_6568"
            style="mask-type: alpha"
            maskUnits="userSpaceOnUse"
            x="0"
            y="0"
            width="23"
            height="24"
          >
            <rect y="0.5" width="23" height="23" fill="#D9D9D9" />
          </mask>
          <g mask="url(#mask0_105201_6568)">
            <path
              d="M6.94787 19.6666C6.64439 19.6666 6.39683 19.5469 6.20516 19.3073C6.01349 19.0677 5.95759 18.8041 6.03745 18.5166L6.70828 15.8333H4.57599C4.25655 15.8333 4.00099 15.7097 3.80933 15.4624C3.61766 15.2145 3.56176 14.9389 3.64162 14.6354C3.68953 14.4118 3.80134 14.2361 3.97703 14.1083C4.15273 13.9805 4.35238 13.9166 4.57599 13.9166H7.18745L8.14578 10.0833H5.53433C5.21488 10.0833 4.95933 9.95969 4.76766 9.71244C4.57599 9.46455 4.52009 9.18887 4.59995 8.8854C4.64787 8.66179 4.75967 8.48609 4.93537 8.35831C5.11106 8.23054 5.31071 8.16665 5.53433 8.16665H8.62495L9.41558 5.0281C9.46349 4.82047 9.56731 4.65276 9.72703 4.52498C9.88676 4.3972 10.0784 4.33331 10.302 4.33331C10.6055 4.33331 10.8531 4.4531 11.0447 4.69269C11.2364 4.93227 11.2923 5.19581 11.2125 5.48331L10.5416 8.16665H14.375L15.1656 5.0281C15.2135 4.82047 15.3173 4.65276 15.477 4.52498C15.6368 4.3972 15.8284 4.33331 16.052 4.33331C16.3555 4.33331 16.6031 4.4531 16.7947 4.69269C16.9864 4.93227 17.0423 5.19581 16.9625 5.48331L16.2916 8.16665H18.4239C18.7434 8.16665 18.9989 8.29027 19.1906 8.53752C19.3822 8.78541 19.4381 9.06109 19.3583 9.36456C19.3104 9.58817 19.1986 9.76387 19.0229 9.89165C18.8472 10.0194 18.6475 10.0833 18.4239 10.0833H15.8125L14.8541 13.9166H17.4656C17.785 13.9166 18.0406 14.0403 18.2322 14.2875C18.4239 14.5354 18.4798 14.8111 18.4 15.1146C18.352 15.3382 18.2402 15.5139 18.0645 15.6416C17.8888 15.7694 17.6892 15.8333 17.4656 15.8333H14.375L13.5843 18.9719C13.5364 19.1795 13.4326 19.3472 13.2729 19.475C13.1131 19.6028 12.9215 19.6666 12.6979 19.6666C12.3944 19.6666 12.1468 19.5469 11.9552 19.3073C11.7635 19.0677 11.7076 18.8041 11.7875 18.5166L12.4583 15.8333H8.62495L7.83433 18.9719C7.78641 19.1795 7.68259 19.3472 7.52287 19.475C7.36314 19.6028 7.17148 19.6666 6.94787 19.6666ZM9.10412 13.9166H12.9375L13.8958 10.0833H10.0625L9.10412 13.9166Z"
              fill="#686868"
            />
          </g>
        </svg>

        <p>{{ currentChannel.name || "lädt..." }}</p>
      </div>
    </div>

    <div
      class="flex flex-col gap-[20px] rounded-[20px] transition-svg-text"
      [ngClass]="{
        'border border-lines p-[20px]': !editChannelDescription
      }"
    >
      <div class="flex justify-between items-center w-full">
        <h3 class="text-[18px] font-bold">Beschreibung</h3>

        <p
          *ngIf="
            !editChannelDescription &&
            currentChannel.channelCreatorId === loggedInUser?.id
          "
          (click)="editChannelDescription = true"
          class="text-hover hover:font-bold cursor-pointer transition-svg-text"
        >
          Bearbeiten
        </p>
        <p
          *ngIf="editChannelDescription"
          (click)="editChannelDescriptionFunction()"
          class="text-hover hover:font-bold cursor-pointer transition-svg-text"
        >
          Speichern
        </p>
      </div>

      <div
        *ngIf="editChannelDescription"
        (click)="channelDescription.focus()"
        class="popup-input-container"
      >
        <input
          #channelDescription
          type="text"
          placeholder="Dein Text hier"
          [(ngModel)]="channelDescriptionInput"
        />
      </div>

      <div
        *ngIf="!editChannelDescription"
        class="max-h-[140px] overflow-y-auto overflow-x-hidden pr-[10px] flex gap-[10px]"
      >
        <p>
          {{ currentChannel.description || "lädt..." }}
        </p>
      </div>

      <div class="w-full h-[1px] bg-lines rounded-full"></div>

      <div class="flex flex-col gap-[20px]">
        <p class="text-[18px] font-bold">Erstellt von</p>

        <p class="text-[24px] text-hover">
          {{ getCurrentChannelCreatorName() || "lädt..." }}
        </p>
      </div>
    </div>

    <!-- show members mobile -->
    <div
      *ngIf="isTablet"
      class="flex flex-col gap-[20px] border border-lines py-[20px] px-[16px] rounded-[20px]"
    >
      <h2 class="text-[24px] font-bold">Mitglieder</h2>

      <div class="flex flex-col gap-[15px]">
        <div
          class="flex flex-col gap-[13px] overflow-y-scroll overflow-x-hidden max-h-[200px] xl:max-h-[400px]"
        >
          <!-- Unten rein rendern -->

          <!-- @for (userId of currentChannel.users; track $index) { -->
          <div
            *ngFor="let userId of currentChannel.users"
            (click)="openProfilePopup(userService.getUserById(userId)!)"
            class="flex hover:bg-bg transition-svg-text items-center gap-[15px] rounded-[30px] px-[20px] py-[4px]"
          >
            <div class="relative">
              <img
                class="w-[50px] h-[50px] rounded-full"
                [src]="
                  userService.getUserById(userId)?.image || 'imgs/avatar1.png'
                "
                alt=""
                (error)="globalVariablesService.handleImageError($event)"
              />

              <div
                class="absolute bottom-0 right-0 h-[14px] w-[14px] rounded-full border-2 border-white"
                [ngClass]="{
                  'bg-online':
                    userService.getUserById(userId)?.status === 'online',
                  'bg-orange-400':
                    userService.getUserById(userId)?.status === 'abwesend',
                  'bg-disable':
                    userService.getUserById(userId)?.status === 'offline'
                }"
              ></div>
            </div>

            <p>
              {{ userService.getUserById(userId)?.name || "NoName" }}
              <span *ngIf="userId === loggedInUser?.id">(Du)</span>
            </p>
          </div>
        </div>

        <div
          (click)="openMemberListPopup()"
          class="hover-primary-bg flex items-center gap-[15px] transition-svg-text px-[29px] py-[12px] rounded-[100px]"
        >
          <div class="bg-bg p-[5px] rounded-full">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <mask
                id="mask0_105708_9192"
                style="mask-type: alpha"
                maskUnits="userSpaceOnUse"
                x="0"
                y="0"
                width="24"
                height="24"
              >
                <rect width="24" height="24" fill="#D9D9D9" />
              </mask>
              <g mask="url(#mask0_105708_9192)">
                <path
                  d="M19 14C18.7167 14 18.4793 13.904 18.288 13.712C18.096 13.5207 18 13.2833 18 13V11H16C15.7167 11 15.4793 10.904 15.288 10.712C15.096 10.5207 15 10.2833 15 10C15 9.71667 15.096 9.479 15.288 9.287C15.4793 9.09567 15.7167 9 16 9H18V7C18 6.71667 18.096 6.479 18.288 6.287C18.4793 6.09567 18.7167 6 19 6C19.2833 6 19.5207 6.09567 19.712 6.287C19.904 6.479 20 6.71667 20 7V9H22C22.2833 9 22.5207 9.09567 22.712 9.287C22.904 9.479 23 9.71667 23 10C23 10.2833 22.904 10.5207 22.712 10.712C22.5207 10.904 22.2833 11 22 11H20V13C20 13.2833 19.904 13.5207 19.712 13.712C19.5207 13.904 19.2833 14 19 14ZM9 12C7.9 12 6.95833 11.6083 6.175 10.825C5.39167 10.0417 5 9.1 5 8C5 6.9 5.39167 5.95833 6.175 5.175C6.95833 4.39167 7.9 4 9 4C10.1 4 11.0417 4.39167 11.825 5.175C12.6083 5.95833 13 6.9 13 8C13 9.1 12.6083 10.0417 11.825 10.825C11.0417 11.6083 10.1 12 9 12ZM2 20C1.71667 20 1.47933 19.904 1.288 19.712C1.096 19.5207 1 19.2833 1 19V17.2C1 16.6333 1.146 16.1123 1.438 15.637C1.72933 15.1623 2.11667 14.8 2.6 14.55C3.63333 14.0333 4.68333 13.6457 5.75 13.387C6.81667 13.129 7.9 13 9 13C10.1 13 11.1833 13.129 12.25 13.387C13.3167 13.6457 14.3667 14.0333 15.4 14.55C15.8833 14.8 16.2707 15.1623 16.562 15.637C16.854 16.1123 17 16.6333 17 17.2V19C17 19.2833 16.904 19.5207 16.712 19.712C16.5207 19.904 16.2833 20 16 20H2ZM3 18H15V17.2C15 17.0167 14.9543 16.85 14.863 16.7C14.771 16.55 14.65 16.4333 14.5 16.35C13.6 15.9 12.6917 15.5623 11.775 15.337C10.8583 15.1123 9.93333 15 9 15C8.06667 15 7.14167 15.1123 6.225 15.337C5.30833 15.5623 4.4 15.9 3.5 16.35C3.35 16.4333 3.22933 16.55 3.138 16.7C3.046 16.85 3 17.0167 3 17.2V18ZM9 10C9.55 10 10.021 9.804 10.413 9.412C10.8043 9.02067 11 8.55 11 8C11 7.45 10.8043 6.97933 10.413 6.588C10.021 6.196 9.55 6 9 6C8.45 6 7.97933 6.196 7.588 6.588C7.196 6.97933 7 7.45 7 8C7 8.55 7.196 9.02067 7.588 9.412C7.97933 9.804 8.45 10 9 10Z"
                  fill="black"
                />
              </g>
            </svg>
          </div>

          <p class="text-[18px]">Mitglieder hinzufügen</p>
        </div>
      </div>
    </div>

    <!--  -->
    <div class="flex justify-end">
      <button (click)="leaveChannel($event)">Channel verlassen</button>
    </div>
  </div>
</section>
